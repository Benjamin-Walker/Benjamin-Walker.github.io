<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ben's Terminal</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .button {
            display: inline-block;
            color: #0f0;
            background-color: transparent;
            border: none;
            cursor: pointer;
            text-decoration: none;
            padding: 2px 5px;
            font-family: inherit;
            font-size: inherit;
        }

        .button:hover {
            color: #000;
            background-color: #0f0;
        }

        #output div {
            white-space: pre-wrap; /* Preserve whitespace */
        }
    </style>
</head>
<body>
    <div class="terminal">
        <div id="output"></div>
        <div class="input-line">
            <span class="prompt">></span>
            <input type="text" id="input" autofocus style="width: 40ch;">
            <span class="blinking-cursor"></span>
        </div>
    </div>
    <script>
        const input = document.getElementById('input');
        const cursor = document.querySelector('.blinking-cursor');
        const output = document.getElementById('output');

        // Typewriter animation
        function typeText(text, callback) {
            let index = 0;
            const interval = setInterval(() => {
                if (index < text.length) {
                    input.value += text[index];
                    updateCursor();
                    index++;
                } else {
                    clearInterval(interval);
                    if (callback) callback();
                }
            }, 60); // Adjust speed here (milliseconds per character)
        }

        function simulateEnterWithButtons(commandOutput = "") {
            const command = input.value;
            output.innerHTML += `<div><span class="prompt">></span> ${command}</div>`;
            if (commandOutput) {
                const links = commandOutput.split("    ").map(page => {
                    return `<button class="button" onclick="navigateTo('${page}')">${page}</button>`;
                }).join("    ");
                output.innerHTML += `<div>${links}</div>`;
            }
            input.value = '';
            updateCursor(); // Reset cursor position
        }

        function simulateEnterWithText(command, commandOutput = "") {
            output.innerHTML += `<div><span class="prompt">></span> ${command}</div>`;
            if (commandOutput) {
                output.innerHTML += `<div>${commandOutput}</div>`;
            }
            input.value = '';
            updateCursor(); // Reset cursor position
        }

		function navigateTo(page, commandRaw = "") {
			const pageText = {
				"About": "Welcome to the About section. Here is some information about me.",
				"Research": "This section highlights my research work and publications.",
				"Code": "Explore my coding projects and repositories here.",
				"Social": "    <button class='button' onclick=\"window.open('https://twitter.com/ML_BenWalker')\">Twitter</button>    <button class='button' onclick=\"window.open('https://bsky.app/profile/benjamincwalker.bsky.social')\">Bluesky</button>    <button class='button' onclick=\"window.open('https://www.linkedin.com/in/benjamin-walker-3880771b9/')\">LinkedIn</button>    <button class='button' onclick=\"window.open('https://github.com/Benjamin-Walker')\">GitHub</button>"
			};
			 if (commandRaw === "") {
				 commandRaw = page;
			 }

			if (page === "CV") {
				output.innerHTML += `<div><span class="prompt">></span> ${commandRaw}</div>`;
				window.open('CV.pdf', '_blank'); // Open the PDF in a new tab
			} else {
				simulateEnterWithText(commandRaw, pageText[page]);
			}
			input.focus(); // Refocus the input element
		}

        function handleSocialCommand(commandRaw) {
            const command = commandRaw.toLowerCase();
            const socialLinks = {
                "twitter": "https://twitter.com/ML_BenWalker",
                "bluesky": "https://bsky.app/profile/benjamincwalker.bsky.social",
                "linkedin": "https://www.linkedin.com/in/benjamin-walker-3880771b9/",
                "github": "https://github.com/Benjamin-Walker"
            };

            if (command in socialLinks) {
                window.open(socialLinks[command]);
                output.innerHTML += `<div><span class="prompt">></span> ${commandRaw}</div>`;
                input.value = '';
                updateCursor();
            }
        }

        // Initial animation
        window.onload = () => {
            typeText("Welcome to Benjamin Walker's website", () => {
                simulateEnterWithButtons();
                setTimeout(() => {
                    typeText("pages", () => {
                        simulateEnterWithButtons("    About    CV    Research    Code    Social");
                    });
                }, 500);
            });
        };

		input.addEventListener('keydown', (e) => {
			if (e.key === 'Enter') {
				const commandRaw = input.value.trim();
				const command = commandRaw.toLowerCase();

				const commands = {
					"pages": "Displays all available pages.",
					"about": "Provides information about me.",
					"cv": "Opens my CV in a new tab.",
					"research": "Shows my research work and publications.",
					"code": "Lists my coding projects.",
					"social": "Displays social media links.",
					"twitter": "Opens my Twitter profile.",
					"bluesky": "Opens my Bluesky profile.",
					"linkedin": "Opens my LinkedIn profile.",
					"github": "Opens my GitHub profile.",
					"exit": "Reloads the website.",
					"help": "Displays this help message with a list of all commands."
				};

				if (command === "pages") {
					simulateEnterWithButtons("    About    CV    Research    Code    Social");
				} else if (command === "cv") {
					navigateTo("CV", commandRaw);
				} else if (command in {
					"about": true,
					"research": true,
					"code": true,
					"social": true
				}) {
					navigateTo(command.charAt(0).toUpperCase() + command.slice(1), commandRaw);
				} else if (command in {
					"twitter": true,
					"bluesky": true,
					"linkedin": true,
					"github": true
				}) {
					handleSocialCommand(commandRaw);
				} else if (command === "exit") {
					output.innerHTML += `<div><span class="prompt">></span> ${commandRaw}</div>`;
					location.reload(); // Reload the page
				} else if (command === "help") {
					const helpMessage = Object.entries(commands)
						.map(([cmd, desc]) => `- ${cmd}: ${desc}`)
						.join("\n");
					simulateEnterWithText("help", helpMessage);
				} else {
					// Fallback for unrecognised commands
					simulateEnterWithText(commandRaw, "Command not recognised. Type 'help' to get a list of available commands.");
				}

				input.value = '';
				updateCursor(); // Reset cursor position
			}
		});

        input.addEventListener('input', updateCursor);

        function updateCursor() {
            const textWidth = getTextWidth(input.value, window.getComputedStyle(input).font);
            cursor.style.transform = `translateX(${textWidth}px)`;
        }

        // Helper function to calculate text width
        function getTextWidth(text, font) {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            context.font = font;
            return context.measureText(text).width;
        }

        // Initialize cursor position
        updateCursor();

		// Refocus input on body click
        document.body.addEventListener('click', () => {
            input.focus();
        });
    </script>
</body>
</html>

